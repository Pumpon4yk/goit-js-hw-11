{"mappings":"iiBAAA,IAAAA,EAAAC,EAAA,S,iEAQMC,EAAOC,SAASC,cAAc,gBAC9BC,EAAUF,SAASC,cAAc,YACjCE,EAASH,SAASC,cAAc,WAElCG,EAAO,GACPC,EAAO,EACPC,EAAW,GACTC,EAAW,IAAIC,EAAAC,GAAJ,CAAmB,cAGpCV,EAAKW,iBAAiB,U,SAUIC,G,OAAXC,EAAUC,MAAAC,KAAAC,U,IARzB,IAMMC,EAAW,IAAIC,sBA4CrB,SAAuBC,EAASC,GAK5BD,EAAQE,SAAQ,SAAAC,GACZ,GAAIA,EAAMC,eAAgB,CAC1B,GAAkC,IAA9BhB,EAASiB,KAAKC,KAAKC,OAEnB,OADAC,EAAAC,OAAOC,KAAK,8DACLT,EAASU,UAAU1B,I,WAUvB2B,EAAQjB,MAAAC,KAAAC,U,CARXgB,GACAC,G,OA9DI,CACZC,KAAM,KACNC,WAAY,QACZC,UAAW,I,SAKAvB,I,OAAAA,EAAfJ,EAAAX,EAAA,CAAAW,EAAA4B,GAAAC,MAAA,SAAAC,EAA0B3B,G,qEACtBA,EAAE4B,iBACFnC,EAAOO,EAAE6B,cAAcC,SAASC,YAAYC,MAAMC,OAElD1C,EAAQ2C,UAAY,GACpBxC,EAAO,EACPC,EAAW,GAEX0B,IAEAc,OAAOC,SAAS,GAAG,IAEN,KAAT3C,EAAW,C,uBACX4B,I,kBACON,EAAAC,OAAOqB,QAAQ,sB,oCAIL,EAAAC,EAAAC,SAAO9C,EAAMC,G,WACI,KADlCC,EAAQ6C,EAAAC,MACK7B,KAAKC,KAAKC,OAAY,C,uBAC/BO,I,kBACON,EAAAC,OAAO0B,QAAQ,6E,QAE1BC,EAAUhD,GACV0B,IACAhB,EAASuC,QAAQpD,G,0DAEjB6B,IAEAwB,QAAQC,IAAGN,EAAAO,I,kBACJhC,EAAAC,OAAOC,KAAK,+D,4DA9BFf,MAAAC,KAAAC,U,CAkCzB,SAASuC,EAAUK,GACF,IAATtD,GACAqB,EAAAC,OAAOiC,QAAQ,oBAAuCC,OAAnBF,EAAIpC,KAAKuC,UAAU,aAE1D5D,EAAQ6D,mBAAmB,aAAa,EAAAC,EAAAd,SAAQS,EAAIpC,KAAKC,OACzDjB,EAAS0D,S,UAsBEnC,I,OAAAA,EAAftB,EAAAX,EAAA,CAAAW,EAAA4B,GAAAC,MAAA,SAAAC,I,yEACIjC,GAAQ,E,mBAGa,EAAA4C,EAAAC,SAAO9C,EAAMC,G,OAC9BiD,EADAhD,EAAQ6C,EAAAC,MAERpB,I,uDAEAA,IACAhB,EAASa,UAAU1B,G,kBACZuB,EAAAC,OAAOC,KAAK,+D,0DAVJf,MAAAC,KAAAC,U,CAcvB,SAASiB,IACL,OAAI7B,EAAO+D,UAAUC,SAAS,aACnBhE,EAAO+D,UAAUE,OAAO,aAE5BjE,EAAO+D,UAAUG,IAAI,Y","sources":["src/js/gallery_infinite-scroll.js"],"sourcesContent":["import { Notify } from 'notiflix/build/notiflix-notify-aio';\nimport SimpleLightbox from \"simplelightbox\";\n\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nimport getApi from './getApi';\nimport cardTml from \"../partials/card.hbs\";\n\nconst form = document.querySelector('.search-form');\nconst gallery = document.querySelector('.gallery');\nconst spiner = document.querySelector('.loader')\n\nlet name = '';\nlet page = 1;\nlet response = {};\nconst lightbox = new SimpleLightbox('.gallery a');\n\n\nform.addEventListener('submit', searchFoto);\n\nconst options = {\n    root: null,\n    rootMargin: '300px',\n    threshold: 1.0\n}\n\nconst observer = new IntersectionObserver(checkPosition, options);\n\nasync function searchFoto(e) {\n    e.preventDefault();\n    name = e.currentTarget.elements.searchQuery.value.trim();\n\n    gallery.innerHTML = '';\n    page = 1;\n    response = {};\n\n    spin();\n\n    window.scrollBy(0, -75);\n\n    if (name === '') {\n        spin();\n        return Notify.warning(\"No data to search\");\n    }\n\n    try {\n        response = await getApi(name, page)\n        if (response.data.hits.length === 0) {\n            spin();\n            return Notify.failure(\"Sorry, there are no images matching your search query. Please try again.\");\n        }\n        creatCard(response);\n        spin();\n        observer.observe(spiner)\n    } catch (error) {\n        spin();\n\n        console.log(error);\n        return Notify.info(\"We're sorry, but you've reached the end of search results.\");\n    }\n}\n\nfunction creatCard(arr) {\n    if (page === 1) {\n        Notify.success(`Hooray! We found ${arr.data.totalHits} images.`);\n    }\n    gallery.insertAdjacentHTML('beforeend', cardTml(arr.data.hits));\n    lightbox.refresh();\n}\n\nfunction checkPosition(entries, observer) {\n    // const contentHeight = gallery.offsetHeight;      // 1) высота блока контента вместе с границами\n    // const yOffset = window.pageYOffset;      // 2) текущее положение скролбара\n    // const window_height = window.innerHeight;      // 3) высота внутренней области окна документа\n    // const y = yOffset + window_height;\n    entries.forEach(entry => {\n        if (entry.isIntersecting) {\n        if (response.data.hits.length === 0) {\n            Notify.info(\"We're sorry, but you've reached the end of search results.\");\n            return observer.unobserve(spiner);\n        }\n            loadMore();\n            spin();\n\n            \n        }\n    })\n}\n\nasync function loadMore() {\n    page += 1;\n\n    try {\n        response = await getApi(name, page);\n        creatCard(response);\n        spin();\n    } catch (error) {\n        spin();\n        observer.unobserve(spiner);\n        return Notify.info(\"We're sorry, but you've reached the end of search results.\");\n    }\n}\n\nfunction spin() {\n    if (spiner.classList.contains(\"is-hidden\")) {\n        return spiner.classList.remove('is-hidden');\n    }\n    return spiner.classList.add('is-hidden');\n}\n\n\n\n\n"],"names":["$bpxeT","parcelRequire","$d7eae090ace82758$var$form","document","querySelector","$d7eae090ace82758$var$gallery","$d7eae090ace82758$var$spiner","$d7eae090ace82758$var$name","$d7eae090ace82758$var$page","$d7eae090ace82758$var$response","$d7eae090ace82758$var$lightbox","$parcel$interopDefault","$5IjG7","addEventListener","e","$d7eae090ace82758$var$_searchFoto","apply","this","arguments","$d7eae090ace82758$var$observer","IntersectionObserver","entries","observer1","forEach","entry","isIntersecting","data","hits","length","$h6c0i","Notify","info","unobserve","$d7eae090ace82758$var$_loadMore","$d7eae090ace82758$var$loadMore","$d7eae090ace82758$var$spin","root","rootMargin","threshold","$2TvXO","mark","_callee","preventDefault","currentTarget","elements","searchQuery","value","trim","innerHTML","window","scrollBy","warning","$kJ0yB","default","_ctx","sent","failure","$d7eae090ace82758$var$creatCard","observe","console","log","t0","arr","success","concat","totalHits","insertAdjacentHTML","$llrIs","refresh","classList","contains","remove","add"],"version":3,"file":"gallery_infinite-scroll.8b693cd6.js.map"}