{"mappings":"qhBAAA,IAAAA,EAAAC,EAAA,S,uCAQA,MAAMC,EAAOC,SAASC,cAAc,gBAC9BC,EAAUF,SAASC,cAAc,YACjCE,EAASH,SAASC,cAAc,WAEtC,IAAIG,EAAO,GACPC,EAAO,EACPC,EAAW,GACf,MAAMC,EAAW,IAAIC,EAAAC,GAAJ,CAAmB,cAGpCV,EAAKW,iBAAiB,UAUtBC,eAA0BC,GAYtB,GAXAA,EAAEC,iBACFT,EAAOQ,EAAEE,cAAcC,SAASC,YAAYC,MAAMC,OAElDhB,EAAQiB,UAAY,GACpBd,EAAO,EACPC,EAAW,GAEXc,IAEAC,OAAOC,SAAS,GAAG,IAEN,KAATlB,EAEA,OADAgB,IACOvB,EAAA0B,OAAOC,QAAQ,qBAG1B,IAEI,GADAlB,QAAiB,EAAAmB,EAAAC,SAAOtB,EAAMC,GACI,IAA9BC,EAASqB,KAAKC,KAAKC,OAEnB,OADAT,IACOvB,EAAA0B,OAAOO,QAAQ,4EAE1BC,EAAUzB,GACVc,IACAY,EAASC,QAAQ9B,E,CACnB,MAAO+B,GAIL,OAHAd,IAEAe,QAAQC,IAAIF,GACLrC,EAAA0B,OAAOc,KAAK,6D,KAtC3B,MAMML,EAAW,IAAIM,sBA4CrB,SAAuBC,EAASC,GAK5BD,EAAQE,SAAQC,IACZ,GAAIA,EAAMC,eAAgB,CAE1B,GADAR,QAAQC,IAAIG,GACsB,IAA9BjC,EAASqB,KAAKC,KAAKC,OAEnB,OADAhC,EAAA0B,OAAOc,KAAK,8DACLG,EAASI,UAAUzC,IAUtCQ,iBACIN,GAAQ,EAER,IACIC,QAAiB,EAAAmB,EAAAC,SAAOtB,EAAMC,GAC9B0B,EAAUzB,GACVc,G,CACF,MAAOc,GAGL,OAFAd,IACAY,EAASY,UAAUzC,GACZN,EAAA0B,OAAOc,KAAK,6D,EAlBfQ,GACAzB,G,OA/DI,CACZ0B,KAAM,KACNC,WAAY,QACZC,UAAW,IAuCf,SAASjB,EAAUkB,GACF,IAAT5C,GACAR,EAAA0B,OAAO2B,QAAQ,oBAAoBD,EAAItB,KAAKwB,qBAEhDjD,EAAQkD,mBAAmB,aAAa,EAAAC,EAAA3B,SAAQuB,EAAItB,KAAKC,OACzDrB,EAAS+C,S,CAqCb,SAASlC,IACL,OAAIjB,EAAOoD,UAAUC,SAAS,aACnBrD,EAAOoD,UAAUE,OAAO,aAE5BtD,EAAOoD,UAAUG,IAAI,Y","sources":["src/js/gallery_infinite-scroll.js"],"sourcesContent":["import { Notify } from 'notiflix/build/notiflix-notify-aio';\nimport SimpleLightbox from \"simplelightbox\";\n\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nimport getApi from './getApi';\nimport cardTml from \"../partials/card.hbs\";\n\nconst form = document.querySelector('.search-form');\nconst gallery = document.querySelector('.gallery');\nconst spiner = document.querySelector('.loader')\n\nlet name = '';\nlet page = 1;\nlet response = {};\nconst lightbox = new SimpleLightbox('.gallery a');\n\n\nform.addEventListener('submit', searchFoto);\n\nconst options = {\n    root: null,\n    rootMargin: '300px',\n    threshold: 1.0\n}\n\nconst observer = new IntersectionObserver(checkPosition, options);\n\nasync function searchFoto(e) {\n    e.preventDefault();\n    name = e.currentTarget.elements.searchQuery.value.trim();\n\n    gallery.innerHTML = '';\n    page = 1;\n    response = {};\n\n    spin();\n\n    window.scrollBy(0, -75);\n\n    if (name === '') {\n        spin();\n        return Notify.warning(\"No data to search\");\n    }\n\n    try {\n        response = await getApi(name, page)\n        if (response.data.hits.length === 0) {\n            spin();\n            return Notify.failure(\"Sorry, there are no images matching your search query. Please try again.\");\n        }\n        creatCard(response);\n        spin();\n        observer.observe(spiner)\n    } catch (error) {\n        spin();\n\n        console.log(error);\n        return Notify.info(\"We're sorry, but you've reached the end of search results.\");\n    }\n}\n\nfunction creatCard(arr) {\n    if (page === 1) {\n        Notify.success(`Hooray! We found ${arr.data.totalHits} images.`);\n    }\n    gallery.insertAdjacentHTML('beforeend', cardTml(arr.data.hits));\n    lightbox.refresh();\n}\n\nfunction checkPosition(entries, observer) {\n    // const contentHeight = gallery.offsetHeight;      // 1) высота блока контента вместе с границами\n    // const yOffset = window.pageYOffset;      // 2) текущее положение скролбара\n    // const window_height = window.innerHeight;      // 3) высота внутренней области окна документа\n    // const y = yOffset + window_height;\n    entries.forEach(entry => {\n        if (entry.isIntersecting) {\n        console.log(entries);\n        if (response.data.hits.length === 0) {\n            Notify.info(\"We're sorry, but you've reached the end of search results.\");\n            return observer.unobserve(spiner);\n        }\n            loadMore();\n            spin();\n\n            \n        }\n    })\n}\n\nasync function loadMore() {\n    page += 1;\n\n    try {\n        response = await getApi(name, page);\n        creatCard(response);\n        spin();\n    } catch (error) {\n        spin();\n        observer.unobserve(spiner);\n        return Notify.info(\"We're sorry, but you've reached the end of search results.\");\n    }\n}\n\nfunction spin() {\n    if (spiner.classList.contains(\"is-hidden\")) {\n        return spiner.classList.remove('is-hidden');\n    }\n    return spiner.classList.add('is-hidden');\n}\n\n\n\n\n"],"names":["$iQIUW","parcelRequire","$428241100400b928$var$form","document","querySelector","$428241100400b928$var$gallery","$428241100400b928$var$spiner","$428241100400b928$var$name","$428241100400b928$var$page","$428241100400b928$var$response","$428241100400b928$var$lightbox","$parcel$interopDefault","$fZKcF","addEventListener","async","e","preventDefault","currentTarget","elements","searchQuery","value","trim","innerHTML","$428241100400b928$var$spin","window","scrollBy","Notify","warning","$kmrz3","default","data","hits","length","failure","$428241100400b928$var$creatCard","$428241100400b928$var$observer","observe","error","console","log","info","IntersectionObserver","entries","observer1","forEach","entry","isIntersecting","unobserve","$428241100400b928$var$loadMore","root","rootMargin","threshold","arr","success","totalHits","insertAdjacentHTML","$6A20M","refresh","classList","contains","remove","add"],"version":3,"file":"gallery_infinite-scroll.5ac4da4b.js.map"}